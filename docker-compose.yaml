services:
  auth:
    build: ./auth
    environment:
      - MONGODB_AUTH_URI=${MONGODB_AUTH_URI}
      - JWT_SECRET=${JWT_SECRET}
      - PORT=${AUTH_PORT}
    depends_on:
      - mongo
    ports:
      - "${AUTH_PORT}:3000"
    networks:
      - app-network
    restart: always

  product:
    build: ./product
    environment:
      - MONGODB_PRODUCT_URI=${MONGODB_PRODUCT_URI}
      - AUTH_SERVICE_URL=${AUTH_SERVICE_URL}
      - JWT_SECRET=${JWT_SECRET}
      - RABBITMQ_URL=${RABBITMQ_URL}
      - PORT=${PRODUCT_PORT}
    depends_on:
      - mongo
      - rabbitmq
    ports:
      - "${PRODUCT_PORT}:3001"
    networks:
      - app-network
    restart: always

  order:
    build: ./order
    environment:
      - MONGODB_ORDER_URI=${MONGODB_ORDER_URI}
      - MONGODB_PRODUCT_URI=${MONGODB_PRODUCT_URI}
      - AUTH_SERVICE_URL=${AUTH_SERVICE_URL}
      - RABBITMQ_URL=${RABBITMQ_URL}
      - RABBITMQ_QUEUE=${RABBITMQ_QUEUE}
      - JWT_SECRET=${JWT_SECRET}
      - PORT=${ORDER_PORT}
    depends_on:
      - mongo
      - rabbitmq
    ports:
      - "${ORDER_PORT}:3002"
    networks:
      - app-network
    restart: always
